{% extends "base.html" %}
{% block content %}
<style>
    .import-form { display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; margin-bottom: 16px; }
    .import-form label { display: flex; flex-direction: column; font-weight: 600; color: #111827; font-size: 0.95rem; }
    .import-form input,
    .import-form select { padding: 6px 8px; border: 1px solid #d1d5db; border-radius: 6px; min-width: 240px; }
    .import-form small { color: #4b5563; font-weight: 400; }
</style>
<div class="card">
    <div style="display:flex; justify-content: space-between; align-items:center; flex-wrap: wrap; gap: 12px;">
        <h2 style="margin:0;">Padrões do professor</h2>
        <div style="display:flex; gap: 8px; flex-wrap: wrap;">
            <form class="import-form" action="{{ url_for('import_ground_truth') }}" method="POST" enctype="multipart/form-data">
                <label>
                    Arquivo CSV de padrões
                    <input type="file" name="data_file" accept=".csv" required>
                    <small>
                        Formato 1: colunas experiment_name, ground_truth.
                        Formato 2: Passo, Step, Valor do Passo, Duracao (s), Timestamp + seleção de experimento.
                    </small>
                </label>
                <label>
                    Experimento (obrigatório para Formato 2)
                    <select name="experiment_id">
                        <option value="">-- selecione --</option>
                        {% for exp in experiments %}
                            <option value="{{ exp.id }}">{{ exp.experiment_name }} (ID {{ exp.id }})</option>
                        {% endfor %}
                    </select>
                </label>
                <button type="submit" class="button">Importar padrões</button>
            </form>
            <a class="button" href="{{ url_for('create_ground_truth') }}">Novo padrão</a>
        </div>
    </div>
    {% if experiments %}
    <p style="margin-top: 8px; color: #4b5563; font-size: 0.95rem;">
        Experimentos cadastrados: {{ experiments|map(attribute='experiment_name')|join(', ') }}.
    </p>
    {% endif %}

    {% if patterns %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Experimento</th>
                <th>Padrão</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for pattern in patterns %}
            <tr>
                <td>{{ pattern.id }}</td>
                <td>{{ pattern.experiment_name }}</td>
                <td class="pattern-cell">{{ pattern.ground_truth }}</td>
                <td>
                    <a class="button" href="{{ url_for('edit_ground_truth', pattern_id=pattern.id) }}">Editar</a>
                    <form class="inline" method="post" action="{{ url_for('delete_ground_truth', pattern_id=pattern.id) }}" onsubmit="return confirm('Deseja remover este padrão?');">
                        <button type="submit" class="secondary">Excluir</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Nenhum padrão cadastrado.</p>
    {% endif %}
</div>
{% endblock %}
